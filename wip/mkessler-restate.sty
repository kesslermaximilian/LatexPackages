\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mkessler-restate}

\RequirePackage{xkeyval}
\RequirePackage{todonotes}
\RequirePackage{xparse}
\RequirePackage{etoolbox}

\newif\ifmkessler@restate@english\mkessler@restate@englishtrue
\DeclareOptionX{english}{\mkessler@restate@englishtrue}
\DeclareOptionX{german}{\mkessler@restate@englishfalse}
\DeclareOptionX{ngerman}{\mkessler@restate@englishfalse}

\define@boolkey+{mkessler-restate.sty}[mkessler@restate@]{strict}[true]{
    \ifmkessler@restate@strict
        \PackageInfo{mkessler-restate}{Strict mode enabled. Undefined restates will throw errors.}%
    \else
        \PackageInfo{mkessler-restate}{Strict mode disabled. Undefined restates will now print placeholder boxes}%
    \fi
}{
    \PackageWarning{mkessler-restate}{Erroneous input to key 'strict' ignored. Provide =true or =false.}
}
\ProcessOptionsX*\relax

\newcommand\restatesetup[1]{\setkeys{mkessler-restate.sty}{#1}}


\NewDocumentCommand{\restatetheorem}{s m}{
    \ifcsdef{#2}{
        \ifx#1\BooleanTrue\csname#2\endcsname*\else\csname#2\endcsname\fi
    }{
    \ifmkessler@restate@strict
    \PackageError{mkessler-restate}{Strict mode enabled but restate command not defined}{The theorem you tried to restate is not defined. Either make sure it is so that it can be printed or disable the strict mode with \noexpand\restatesetup{strict=false} to print a placeholder instead}
    \else
    \missingfigure{\ifmkessler@restate@english Here theorem \textbf{#2} is missing, since it is not part of this document.\else Hier fehlt die Wiederholung von Satz \textbf{#2}, der nicht Teil dieses Dokumentes ist.\fi}
    \fi
    }
}
